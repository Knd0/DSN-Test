<div class="p-6 bg-gradient-to-br from-gray-900 via-gray-800 to-black min-h-screen text-white">
  <h1 class="text-4xl font-extrabold mb-8 text-center tracking-wide bg-gradient-to-r from-indigo-400 to-purple-500 bg-clip-text text-transparent">
    DSN Kanban
  </h1>

  <!-- Crear nueva tarea -->
  <!-- Formulario de creación + buscador -->
<div class="mb-8 max-w-3xl mx-auto">
  <!-- Buscador -->
  <div class="mb-4 flex flex-wrap gap-3 justify-center">
    <input
      type="text"
      [(ngModel)]="searchText"
      name="search"
      placeholder="Buscar tarea..."
      class="w-full sm:w-64 px-3 py-2 rounded-md border border-gray-600 bg-gray-800 text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-400"
    />
  </div>

  <!-- Formulario de nueva tarea -->
  <form (ngSubmit)="createTask()" class="flex flex-wrap justify-center gap-3">
    <input
      type="text"
      [(ngModel)]="newTaskTitle"
      name="title"
      placeholder="Título..."
      required
      class="px-3 py-2 rounded-md border border-gray-600 bg-gray-800 text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-400 w-full sm:w-48"
    />
    <input
      type="text"
      [(ngModel)]="newTaskDescription"
      name="description"
      placeholder="Descripción..."
      class="px-3 py-2 rounded-md border border-gray-600 bg-gray-800 text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-400 w-full sm:w-64"
    />
    <input
      type="number"
      [(ngModel)]="newTaskstoryPoints"
      name="storyPoints"
      placeholder="Story Points"
      min="0"
      required
      class="px-3 py-2 rounded-md border border-gray-600 bg-gray-800 text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-400 w-20"
    />
    <button
      type="submit"
      class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-md flex items-center gap-2 transition"
    >
      <i class="fa-solid fa-plus"></i> Agregar
    </button>
  </form>
</div>

  <!-- Tablero -->
  <div class="flex gap-6 flex-wrap md:flex-nowrap">
    <div *ngFor="let col of columns" class="flex-1 bg-gray-800/80 backdrop-blur-sm p-4 rounded-2xl shadow-xl">
      <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-2">
        <h2 class="text-lg font-bold capitalize tracking-wide">{{ col }}</h2>
        <span class="bg-gray-700 text-sm px-2 py-1 rounded-full shadow">{{ filteredBoard[col]?.length || 0 }}</span>
      </div>

      <div *ngIf="filteredBoard[col]" cdkDropList [id]="col" [cdkDropListData]="filteredBoard[col]" [cdkDropListConnectedTo]="getConnectedCols(col)" class="min-h-[200px] flex flex-col gap-3" (cdkDropListDropped)="drop($event, col)">
        <div *ngFor="let task of filteredBoard[col]" cdkDrag class="task-card" (click)="openModal(task)">
          <div class="truncate max-w-[80%] font-medium">{{ task?.title ?? '(sin título)' }}</div>

          <span class="text-gray-400 text-xs">{{ task.createdAt | date : 'shortTime' }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div *ngIf="modalTask" class="modal-backdrop">
    <div class="modal">
      <h3 class="text-2xl font-bold mb-4 text-indigo-400">{{ isEditing ? 'Editar Tarea' : modalTask.title }}</h3>
      <p *ngIf="!isEditing" class="mb-4 text-gray-300">{{ modalTask.description || 'Sin descripción' }}</p>

      <div *ngIf="isEditing" class="flex flex-col gap-3">
        <input type="text" [(ngModel)]="modalTask.title" class="input w-full" />
        <textarea [(ngModel)]="modalTask.description" rows="4" class="input w-full"></textarea>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <button *ngIf="!isEditing" class="btn-edit" (click)="isEditing = true"><i class="fa-solid fa-pencil"></i> Editar</button>
        <button *ngIf="isEditing" class="btn-save" (click)="updateTask()"><i class="fa-solid fa-check"></i> Guardar</button>
        <button class="btn-delete" (click)="confirmDelete()"><i class="fa-solid fa-trash"></i> Eliminar</button>
        <button class="btn-close" (click)="closeModal()"><i class="fa-solid fa-x"></i> Cerrar</button>
      </div>
    </div>
  </div>

<div class="mt-8 max-w-2xl mx-auto">
  <h2 class="text-2xl font-bold text-gray-100 mb-4 border-b border-gray-700 pb-2">Auditoría de Tareas</h2>

  <div class="bg-gray-900 rounded-lg shadow-lg p-4 max-h-[400px] overflow-y-auto">
    <ul class="space-y-3">
      <li *ngFor="let evt of socket.auditLog()" class="bg-gray-800 rounded-lg p-3 hover:bg-gray-700 transition flex flex-col">
        <div class="flex justify-between items-center">
          <div class="flex items-center space-x-2">
            <span class="text-gray-400 text-sm">[{{ evt.timestamp | date:'shortTime' }}]</span>
            <span class="text-indigo-300 font-semibold">{{ evt.task?.title || '(sin título)' }}</span>
            <span
              [ngClass]="{
                'text-green-400': evt.type === 'created',
                'text-yellow-400': evt.type === 'updated',
                'text-red-400': evt.type === 'deleted',
                'text-blue-400': evt.type === 'moved'
              }"
              class="ml-2 font-medium text-sm"
            >
              {{ evt.type === 'moved' ? 'movida' : evt.type }}
            </span>
          </div>
        </div>

        <div class="mt-2 text-gray-300 text-sm space-y-1 pl-2">
          <div *ngIf="evt.type === 'moved' && socket.isMoveEvent(evt)">
            De: <span class="font-semibold">{{ evt.fromColumn }}</span> → A: <span class="font-semibold">{{ evt.toColumn }}</span>
          </div>
          <div>Descripción: <span class="italic">{{ evt.task?.description || '(sin descripción)' }}</span></div>
          <div>Puntos de historia: <span class="font-semibold">{{ evt.task?.storyPoints }}</span></div>
        </div>
      </li>
    </ul>
  </div>
</div>



</div>
