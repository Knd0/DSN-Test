<div class="p-6 bg-gradient-to-br from-gray-900 via-gray-800 to-black min-h-screen text-white">
  <h1 class="text-4xl font-extrabold mb-8 text-center tracking-wide bg-gradient-to-r from-indigo-400 to-purple-500 bg-clip-text text-transparent">
    DSN Kanban
  </h1>

  <!-- Crear nueva tarea -->
  <form (ngSubmit)="createTask()" class="mb-10 flex justify-center gap-3 flex-wrap">
    <input type="text" [(ngModel)]="newTaskTitle" name="title" placeholder="Título..." required class="input" />
    <input type="text" [(ngModel)]="newTaskDescription" name="description" placeholder="Descripción..." class="input" />
    <input type="number" [(ngModel)]="newTaskStorypoints" name="storypoints" placeholder="Story Points" min="0" class="input w-32" required />
    <button type="submit" class="btn-primary">
      <i class="fa-solid fa-plus"></i> Agregar
    </button>
  </form>

  <!-- Tablero -->
  <div class="flex gap-6 flex-wrap md:flex-nowrap">
    <div *ngFor="let col of columns" class="flex-1 bg-gray-800/80 backdrop-blur-sm p-4 rounded-2xl shadow-xl">
      <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-2">
        <h2 class="text-lg font-bold capitalize tracking-wide">{{ col }}</h2>
        <span class="bg-gray-700 text-sm px-2 py-1 rounded-full shadow">{{ filteredBoard[col]?.length || 0 }}</span>
      </div>

      <div *ngIf="filteredBoard[col]" cdkDropList [id]="col" [cdkDropListData]="filteredBoard[col]" [cdkDropListConnectedTo]="getConnectedCols(col)" class="min-h-[200px] flex flex-col gap-3" (cdkDropListDropped)="drop($event, col)">
        <div *ngFor="let task of filteredBoard[col]" cdkDrag class="task-card" (click)="openModal(task)">
          <div class="truncate max-w-[80%] font-medium">{{ task.title }}</div>
          <span class="text-gray-400 text-xs">{{ task.createdAt | date : 'shortTime' }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div *ngIf="modalTask" class="modal-backdrop">
    <div class="modal">
      <h3 class="text-2xl font-bold mb-4 text-indigo-400">{{ isEditing ? 'Editar Tarea' : modalTask.title }}</h3>
      <p *ngIf="!isEditing" class="mb-4 text-gray-300">{{ modalTask.description || 'Sin descripción' }}</p>

      <div *ngIf="isEditing" class="flex flex-col gap-3">
        <input type="text" [(ngModel)]="modalTask.title" class="input w-full" />
        <textarea [(ngModel)]="modalTask.description" rows="4" class="input w-full"></textarea>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <button *ngIf="!isEditing" class="btn-edit" (click)="isEditing = true"><i class="fa-solid fa-pencil"></i> Editar</button>
        <button *ngIf="isEditing" class="btn-save" (click)="updateTask()"><i class="fa-solid fa-check"></i> Guardar</button>
        <button class="btn-delete" (click)="confirmDelete()"><i class="fa-solid fa-trash"></i> Eliminar</button>
        <button class="btn-close" (click)="closeModal()"><i class="fa-solid fa-x"></i> Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Auditoría -->
  <div class="mt-10 bg-gray-800/70 p-4 rounded-2xl shadow-xl max-h-64 overflow-y-auto">
    <h3 class="text-lg font-bold mb-2 text-indigo-400">Auditoría de cambios</h3>
    <ul>
      <li *ngFor="let evt of socket.auditLog()" class="mb-1 text-gray-300 text-sm">
        [{{ evt.timestamp | date:'shortTime' }}] Tarea 
        "<span class="text-indigo-300">{{ evt.task.title }}</span>" 
        {{ evt.type }}
        <span *ngIf="evt.type==='moved'">a {{ evt.task.column }}</span>
      </li>
    </ul>
  </div>
</div>
