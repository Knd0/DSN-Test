<div class="p-6 bg-gradient-to-br from-gray-900 via-gray-800 to-black min-h-screen text-white">

  <!-- Header -->
  <h1 class="text-4xl font-extrabold mb-8 text-center tracking-wide bg-gradient-to-r from-indigo-400 to-purple-500 bg-clip-text text-transparent">
    DSN Kanban
  </h1>

  <!-- Buscar -->
  <div class="flex justify-center mb-8">
    <div class="relative w-full md:w-1/3">
      <input
        type="text"
        [(ngModel)]="searchText"
        placeholder="Buscar tareas..."
        class="pl-10 pr-4 py-3 w-full rounded-xl text-gray-900 border border-gray-700 shadow focus:outline-none focus:ring-2 focus:ring-indigo-500"
      />
      <i class="fa-solid fa-magnifying-glass absolute left-3 top-3.5 text-gray-400"></i>
    </div>
  </div>

  <!-- Crear nueva tarea -->
  <form (ngSubmit)="createTask()" class="mb-10 flex justify-center gap-3 flex-wrap">
    <input
      type="text"
      [(ngModel)]="newTaskTitle"
      name="title"
      placeholder="Título de la tarea..."
      class="p-3 rounded-xl w-64 text-gray-900 border border-gray-700 shadow focus:outline-none focus:ring-2 focus:ring-indigo-500"
      required
    />
    <input
      type="text"
      [(ngModel)]="newTaskDescription"
      name="description"
      placeholder="Descripción..."
      class="p-3 rounded-xl w-64 text-gray-900 border border-gray-700 shadow focus:outline-none focus:ring-2 focus:ring-indigo-500"
    />
    <button type="submit" class="flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 px-5 py-3 rounded-xl hover:opacity-90 transition shadow-lg">
      <i class="fa-solid fa-plus"></i>
      Agregar
    </button>
  </form>

  <!-- Tablero -->
  <div class="flex gap-6 flex-wrap md:flex-nowrap">
    <div *ngFor="let col of columns" class="flex-1 bg-gray-800/80 backdrop-blur-sm p-4 rounded-2xl shadow-xl transition-transform hover:scale-[1.02]">
      <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-2">
        <h2 class="text-lg font-bold capitalize tracking-wide">{{ col }}</h2>
        <span class="bg-gray-700 text-sm px-2 py-1 rounded-full shadow">{{ filteredBoard[col]?.length || 0 }}</span>
      </div>

      <div *ngIf="filteredBoard[col]"
        cdkDropList
        [id]="col"
        [cdkDropListData]="filteredBoard[col]"
        [cdkDropListConnectedTo]="getConnectedCols(col)"
        class="min-h-[200px] flex flex-col gap-3"
        (cdkDropListDropped)="drop($event, col)">
        <div *ngFor="let task of filteredBoard[col]" cdkDrag
          class="bg-gray-700/90 p-4 rounded-xl shadow-md hover:bg-gray-600/90 transition cursor-pointer flex justify-between items-center group"
          (click)="openModal(task)">
          <div class="truncate max-w-[80%] font-medium">{{ task.title }}</div>
          <span class="text-gray-400 text-xs group-hover:text-indigo-300 transition">{{ task.createdAt | date : 'shortTime' }}</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div *ngIf="modalTask" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex justify-center items-center z-50">
  <div class="bg-gray-800 rounded-2xl p-6 w-96 shadow-2xl transform transition-all duration-300 scale-100 border border-gray-700">
    <h3 class="text-2xl font-bold mb-4 text-indigo-400">{{ isEditing ? 'Editar Tarea' : modalTask.title }}</h3>

    <p *ngIf="!isEditing" class="mb-4 text-gray-300">{{ modalTask.description || 'Sin descripción' }}</p>

    <div *ngIf="isEditing" class="flex flex-col gap-3">
      <input type="text" [(ngModel)]="modalTask.title"
        class="p-3 rounded-xl text-gray-900 w-full focus:ring-2 focus:ring-indigo-500" />
      <textarea [(ngModel)]="modalTask.description" rows="4"
        class="p-3 rounded-xl text-gray-900 w-full focus:ring-2 focus:ring-indigo-500"
        placeholder="Descripción"></textarea>
    </div>

    <div class="flex justify-end gap-2 mt-6">
      <button *ngIf="!isEditing" class="flex items-center gap-1 bg-indigo-600 px-4 py-2 rounded-xl hover:bg-indigo-700 transition" (click)="isEditing = true">
        <i class="fa-solid fa-pencil"></i>
        Editar
      </button>
      <button *ngIf="isEditing" class="flex items-center gap-1 bg-green-600 px-4 py-2 rounded-xl hover:bg-green-700 transition" (click)="updateTask()">
        <i class="fa-solid fa-check"></i>
        Guardar
      </button>
      <button class="flex items-center gap-1 bg-red-600 px-4 py-2 rounded-xl hover:bg-red-700 transition" (click)="confirmDelete()">
        <i class="fa-solid fa-trash"></i>
        Eliminar
      </button>
      <button class="flex items-center gap-1 bg-gray-600 px-4 py-2 rounded-xl hover:bg-gray-700 transition" (click)="closeModal()">
        <i class="fa-solid fa-x"></i>
        Cerrar
      </button>
    </div>
  </div>
</div>
